# PrivCount Counter Names

The names of the PrivCount counters are used when communicating between nodes.

## Node Agreement

All nodes in the network must agree on the counter names they intend to use.
(The tor patch does not know any counter names: the PrivCount python code maps
each counter to the events it uses, and processes events to increment
counters.)

If new counters are added, they can not be reported by Data Collectors until
all Share Keepers and the Tally Server know about them.

If old counters are removed, all Data Collectors must stop reporting them
before any Share Keeper or the Tally Server can stop processing them.

## Naming PrivCount Counters

### Legal Counter Names

PrivCount counter names consist of one or more ASCII characters in the set:
* A-Za-z0-9

This set of characters is enforced by test/test_counter_match.sh

The autogenerated counters in the Traffic Model also use the characters:
* _+-

The Traffic Model template counter names are ignored by
test/test_counter_match.sh

### Naming Standards

PrivCount counters should be named using a consistent format.
This format makes it easier to work out what each counter is counting.

The most important rule is:
* counters should be named after what they count, not how they are used
  (we can change what we use a counter for, but if we change what it counts,
  it is really a different counter)

Other general rules:
* Each name consists of a root descriptive word, one or more qualifiers, and a
  word that describes the type of counter.
* Names read like English sentences, starting with "This is a/an/the..."
* Qualifiers generally come before the noun they modify, but follow normal
  English usage as much as possible.
* We don't repeat words in a name.
* We don't use plurals or words like "Total" or "All". They don't add anything
  to the meaning of the name. (But they do lead to inconsistent names.)

#### A Pattern for PrivCount Counter Names

Here is how you can construct a PrivCount counter name:
* Entry/Exit/
* Active/Inactive/ (order varies: before the noun it qualifies)
* Interactive/OtherPort/P2P/Web/ (order varies: before the noun it qualifies)
* Connection/Circuit/Stream/ClientIP/Zero
* Inbound/Outbound/Inter/ (prefer later if order is ambiguous)
* Circuit/Stream/TrafficModel/
* Cell/Byte/Creation/Life/Emission/Transition/SquaredLogDelay/LogDelay/
* Count/Ratio/Time

A trailing slash means that the item is optional.

We could also encode the difference between a single count and a histogram
in the name, but we do not gain anything by doing this at the moment. In the
future, if we have a histogram counter and a single bin counter for the same
data, we should rename counters using multiple bins to Histogram, and single
bins to Count. (Ratio and Time bins are also Histograms.)

#### Suffixes for PrivCount Traffic Model Counters

The autogenerated Traffic Model counters have a suffix with
underscore-separated state and direction qualifiers.

See CounterDefinitions.markdown for details.

## Using PrivCount Counters

Counters must be referenced using a particular format so they are easy to
check for consistency.

### Source Code
* One counter per line (other code can appear on that line)
* In single quotes ''
* Following the existing format

### Tests

* One counter per line (no other declarations on that line)
* Followed by a colon :
* Following the existing format
