# PrivCount Counter Definitions

Each privcount counter is named after the information it collects (see
NamingCounters.markdown).

Some Tor network overheads (TorNetworkOverhead.markdown) are filtered out of
counters and counter events (TorEvents.markdown). In particular, all counters
exclude one-hop directory connections and circuits initated by the current
relay.

## Base Counts

This section describes the types of counters that are collected.

### Count

The number of Connections, Circuits, Streams, Cells, or Bytes seen by the
relay.

Some overheads are excluded:
* Streams with zero (total read and write) or negative byte counts are ignored.
* Cell counts are not collected on Inactive Circuits.
* EntryClientIP{Active,Inactive}CircuitCount ignore zero counts.

### ClientIPCount

The number of unique Client IP addresses seen by the relay in each 10 minute
interval.

All ClientIP counters are rotated every 10 minutes to limit the number of
Client IP addresses stored in memory.

### LifeTime

The number of seconds between the creation and destruction of the Connection,
Circuit, or Stream.

The precision is determined by the bins used to collect the counter. The
underlying event timestamps have microsecond precision. But the Tor event loop
only runs once per second, so sub-second bins are unlikely to be accurate or
meaningful.

### CircuitInterStreamCreationTime

The number of seconds between the creation of a Stream and the creation of the
next Stream on that Circuit. Circuits with zero or one Streams are excluded
from this counter.

See LifeTime for information about timestamp and event loop precision.

### Ratio

The base 2 log ratio of the Inbound and Outbound (see below) Cells or Bytes.
Uses the total Cells or Bytes over the life of the Circuit or Stream.

Calculated using log(Outbound/Inbound, 3), with the following boundary
conditions:
* 0.0 when Outbound equals Inbound,
* -.inf when Outbound is zero, and
* .inf when Inbound is zero.

### TrafficModelEmissionCount

The number of packets emitted by the relay.

The traffic model assumes each packet is at most 1500 bytes. Byte events are
split into packets, assuming no delay between emitted packets in the same byte
event.

### TrafficModelTransitionCount

The number of state transitions in the traffic model.

### TrafficModelLogDelayTime and TrafficModelSquaredLogDelayTime

The (squared) natural logarithm of the inter-packet delay time in microseconds.
These are derived from socket read/write timestamps, in a similar way to
InterStreamCreationTimes. Each socket read/write is then split on 1500 byte
boundaries into packets. The entire delay is assigned to the first packet in
the socket read/write.

Calculated using int(log(DelayTime)), with the following boundary
conditions:
* 0 when DelayTime is less than 1 microsecond.

For the Squared counter, the value is squared after truncation to an integer.

See LifeTime for information about timestamp and event loop precision.

### ZeroCount

A counter that is not incremented by any relay.

The aggregated value of this counter must be zero. A non-zero value indicates
that one or more Share Keepers or Data Collectors failed to provide results.

## Counter Variants and Sub-Categories

This section describes how some counters are split or filtered.

### Entry/Exit

This counter is only collected when the relay is in this position in the
Connection or Circuit.

For example:
* When Tor clients connect to the Tor network, they make an Entry Connection.
* When Tor clients access a remote server, they make an Exit Stream.

### Active/Inactive

An Active Circuit is being used by a Tor client. Circuit Activity is checked
when a Circuit ends.

The activity thresholds are:
* Entry Circuits: 8 or more Cells were transmitted over the Circuit.
                  Uses the sum of Inbound and Outbound Cells.
* Entry ClientIPs: 1 or more Entry Circuits were active in this rotation
                   period.
* Exit Circuits: 1 or more Streams ended on the Circuit.

### Stream Port

Stream sub-categories based on the remote port used by the Stream. A Circuit
can belong to multiple sub-categories based on its Streams: if it does,
its counters are incremented for each sub-category.

The sub-categories are:
* Interactive: ports typically used for low-latency connections
* P2P: ports typically used for bulk data transfer
* Web: ports typically used for web browsing
* OtherPort: any ports not listed in any other category

### Inbound/Outbound

The direction of Cell or Byte traffic on the Circuit or Stream.

Inbound data is read/received/downloaded by the relay.
Outbound data is written/sent/uploaded by the relay.

### Traffic Model Template Counters

The Traffic Model autogenerates a set of counters from counter templates.

These autogenerated Traffic Model counters are based on the static Traffic
Model counters, with a suffix containing underscore-separated state and
direction qualifiers.

The number of states and the state labels vary depending on the model.
The state labels used below are examples only.

Transition counters use these qualifiers:
* START/Thinking/Blabbing (Source State)
* Thinking/Blabbing (Destination State)

Transitions from the START state are not counted in
ExitStreamTrafficModelTransitionCount, but are counted in the
ExitStreamTrafficModelTransitionCount_START_* counters.

Emission and Delay counters use these qualifiers:
* Thinking/Blabbing/End (Current State)
* -/+/F (Direction)

The Traffic Model counters use '-' for Inbound, '+' for Outbound, and 'F' for
the End state.
